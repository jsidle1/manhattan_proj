component=require('component') computer=require('computer') sides=require('sides') SIDES={INPUT=sides.west,OUTPUT=sides.east,NUCLEAR_REACTOR=sides.bottom,NUCLEAR_REACTOR_POWER_BUTTON=sides.bottom} ADDRESSES={TRANSPOSER='7ca8dcff-65e0-4769-bf18-2be1d74d6c71',POWER_BUTTON='e9ad2e5a-a17c-4beb-be49-a4f691d59dcb'} C={name='gregtech:gt.360k_Helium_Coolantcell',isDamaged=function(stack)return stack.maxDamage-1<=stack.damage end} F={name='gregtech:gt.rodUranium4',isDamaged=function(stack)return stack.damage==stack.maxDamage end} E={name='',isDamaged=function(_)return false end} local LAYOUT = {C,F,F,F,C,F,F,C,F,F,F,C,F,F,F,F,C,F,C,F,F,F,F,C,F,F,F,F,F,F,C,F,F,F,F,C,F,C,F,F,F,F,C,F,F,F,C,F,F,C,F,F,F,C} nuclearPowerButton=component.proxy(component.get(ADDRESSES.POWER_BUTTON)) transposer=component.proxy(component.get(ADDRESSES.TRANSPOSER)) reactor={started=false,damagedSlots={}} function reactor:initializationCheck() inventorySize=transposer.getInventorySize(SIDES.NUCLEAR_REACTOR) print("Inventory size: "..inventorySize..", Expected: "..#LAYOUT) if inventorySize~=#LAYOUT then print("ERROR: Inventory size mismatch!") return false end for slot,preset in pairs(LAYOUT) do stack=transposer.getStackInSlot(SIDES.NUCLEAR_REACTOR,slot) print("Slot "..slot..": Expected="..(preset.name or "empty")..", Got="..(stack and stack.name or "empty")) if preset.name=='' and stack~=nil then print("ERROR: Slot "..slot.." should be empty but contains "..stack.name) return false end if preset.name~='' then if stack==nil then print("ERROR: Slot "..slot.." is empty but should contain "..preset.name) return false end if stack.name~=preset.name then print("ERROR: Slot "..slot.." contains "..stack.name.." but should contain "..preset.name) return false end end end print("Initialization check passed!") return true end function reactor:start() if not self.started then print("[REACTOR] Starting reactor...") nuclearPowerButton.setActive(true) self.started=true print("[REACTOR] Reactor started!") else print("[REACTOR] Reactor already started") end end function reactor:stop() if self.started then print("[REACTOR] Stopping reactor...") nuclearPowerButton.setActive(false) self.started=false print("[REACTOR] Reactor stopped!") end end function reactor:findInput(what) while true do slot=1 stacksIterator=transposer.getAllStacks(SIDES.INPUT) for stack in stacksIterator do if stack.name==what then return slot end slot=slot+1 end os.sleep(5) end end function reactor:discharge() for _,slot in ipairs(self.damagedSlots) do while transposer.getSlotStackSize(SIDES.NUCLEAR_REACTOR,slot)~=0 do if transposer.transferItem(SIDES.NUCLEAR_REACTOR,UIDES.OUTPUT,1,slot)==0 then os.sleep(5) end end end end function reactor:load() while #self.damagedSlots>0 do slot=self.damagedSlots[1] what=LAYOUT[slot] inputSlot=self:findInput(what) transposer.transferItem(SIDES.INPUT,UIDES.NUCLEAR_REACTOR,1,inputSlot,slot) table.remove(self.damagedSlots,1) end end function reactor:hasDamaged() slot=1 stacksIterator=transposer.getAllStacks(SIDES.NUCLEAR_REACTOR) for stack in stacksIterator do if LAYOUT[slot].isDamaged(stack) then print("[DAMAGE] Slot "..slot.." is damaged! (damage="..stack.damage.."/"..stack.maxDamage..")") return true end slot=slot+1 end print("[DAMAGE] No damaged items found") return false end function reactor:ensure() if not self:hasDamaged() then return end print("[ENSURE] Starting maintenance cycle...") self:stop() os.sleep(1) slot=1 stacksIterator=transposer.getAllStacks(SIDES.NUCLEAR_REACTOR) for stack in stacksIterator do if LAYOUT[slot].isDamaged(stack) then table.insert(self.damagedSlots,slot) end slot=slot+1 end print("[ENSURE] Found "..#self.damagedSlots.." damaged slots to replace") self:discharge() print("[ENSURE] Discharged damaged items") self:load() print("[ENSURE] Loaded new items, maintenance cycle complete") end function reactor:loop() print("[LOOP] Checking reactor health...") self:ensure() if not self.started then self:start() end print("[LOOP] Reactor running normally") end function reactor:run() print("[RUN] Starting initialization check...") if not self:initializationCheck() then print("[RUN] FATAL: Initialization failed!") for _=1,3 do computer.beep('.') os.sleep(1) end return end print("[RUN] Initialization successful! Starting reactor loop...") loopCount=0 while true do loopCount=loopCount+1 print("\n[RUN] === Loop iteration "..loopCount.." ===") self:loop() os.sleep(0.25) end end function start() reactor:run() end start()
